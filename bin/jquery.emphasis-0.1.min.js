/*
jQuery.emphasis.js

Copyright 2013 mzhou / @zhoumm
Version: 0.1.1
License:
    https://raw.github.com/zmmbreeze/jquery.emphasis/master/MIT-LICENTSE.txt
*/

!function(a){function p(b,c){if(!o){var d=document.createElement("style");d.type="text/css",a("head").eq(0).prepend(d),o=document.styleSheets[0]}o.insertRule?o.insertRule(b+"{"+c+"}",o.cssRules.length):o.addRule(b,c,-1)}function q(){if(!q.inited){q.inited=!0,p("."+e,"position:relative;display:inline-block;_zoom:1;float:none;border:none;margin:0;padding:0 0 0.5em 0;vertical-align: baseline;color:inherit;font-size:inherit;font-family:inherit;letter-spacing: normal;text-decoration:inherit;line-height:inherit;"),p("."+e+"."+h,"padding:0.5em 0 0 0;"),p("."+f,"position:relative;float:none;border:none;margin:0;padding:0;vertical-align: baseline;color:inherit;font-size:inherit;font-family:inherit;letter-spacing: normal;text-decoration:inherit;line-height:inherit;");var a="position:absolute;bottom: 0;left: 0;height: 1em;line-height: 1em;text-align: center;width: 100%;float:none;border:none;margin:0;padding:0;vertical-align: baseline;color:inherit;font-size: inherit;font-family:inherit;text-decoration: none;";p("."+f+":before",a+"bottom: -1em;"),p("."+e+":before",a),p("."+f+"."+g+":before","bottom: -0.5em;width: 200%;"),p("."+f+"."+h+":before","top: -0.5em;bottom: auto;"),p("."+e+"."+g+":before","width: 200%;"),p("."+e+"."+h+":before","top: 0;bottom: auto;")}}function s(a,c,d){var e=r[a];if(e[c])return e[c];var f=a+k++ +b;return p("."+f+":before",d),e[c]=f,f}function t(a,b){var c=b.charAt(0).toLowerCase()+b.slice(1);if("undefined"!=typeof a.style[c])return c;for(var d=["webkit","moz","o","ms"],e=0,f=d.length;f>e;e++)if(""===a.style[d[e]+b])return d[e]+b;return!1}function u(a){return a.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()}).replace(/^(webkit|moz|o|ms)\-/,"-$1-")}function v(){if("undefined"!=typeof v.result)return v.result;var b,a=document.createElement("div"),c=t(a,"Transform"),d=t(a,"TransformOrigin");return c&&d?(c=u(c),d=u(d),b=[c,d]):b=null,v.result=b,b}function w(){if("undefined"!=typeof w.result)return w.result;var d,a=document.createElement("div"),b=t(a,"TextEmphasis"),c=t(a,"TextEmphasisPosition");return d=b&&c?[b,c]:null,w.result=d,d}function x(b,c){for(var g,d=b.children(),h=0,i=d.length;i>h;h++){g=d[h];var j=g.className,k=-1!==j.indexOf(e)||-1!==j.indexOf(f),l=g.nodeName.toLowerCase();n[l]||k||x(a(g),c)}for(var o,m=b.contents(),p=0,q=m.length;q>p;p++)o=m[p],3===o.nodeType&&y(a(o),b,c)}function y(a,b,c){var d=parseInt(b.css("font-size"),10),h=z(b,d),i=d/2,k=!1;i>(h-d)/2&&(k=!0);var n,l=v();n=l?l[0]+":scale(0.5);"+l[1]+("over"===c.position?":top left;":":bottom left;"):"font-size:"+i+"px;"+"height:"+i+"px;"+"line-height:"+i+"px;";var o=s("mark",l?c.position:i,n),p="";c.color&&(p=s("color",c.color,"color:"+c.color+" !important;"));var q=k?e:f,r=s("char",c.character,"content:'"+c.character+"';"),t=j[c.position],u=b.css("letter-spacing"),w="";"normal"!==u&&0!==u&&(w="margin-right:"+u+";");for(var B,x='<span class="'+q+" "+r+" "+o+" "+p+" "+(l?g:"")+" "+t+'" style="'+w+'">',y="</span>",A=a.text(),C=[],D=0,E=A.length;E>D;D++)B=A.charAt(D),m[B]?C.push(B):(C.push(x),C.push(B),C.push(y));a.replaceWith(C.join(""))}function z(a,b){var c=a.css("line-height");return"normal"===c?A(b):c.match(/px/)?parseInt(c,10):b*c}function A(b){if("undefined"!=typeof A.result)return A.result;var c=a('<div style="padding:0;display:block;border:0;position:absolute;line-height:normal;overflow:hidden;width:100px;">Some words.</div>');c.css("font-size",b+"px"),c.appendTo("body");var d=c.height();return c.remove(),A.result=d,d}var o,b="9a91ab9b8e64d2cf7fce0616b66efbaf",c="emphasisOldHtml"+b,d="emphasis"+b,e="inline-block"+b,f="inline"+b,g="scale"+b,h="over"+b,i="under"+b,j={over:h,under:i},k=0,l={dot:["\u2022","\u25e6"],circle:["\u25cf","\u25cb"],"double-circle":["\u25c9","\u25ce"],triangle:["\u25b2","\u25b3"],sesame:["\ufe45","\ufe46"]},m={" ":1,"\xa0":1,"\u1361":1,"\u10100":1,"\u10101":1,"\u1039F":1,"\u1091F":1,"\u0f0b":1,"\u0f0c":1,"\u200b":1,"\u3000":1,"\u2000":1,"\u200a":1,"\0":1,"	":1,"\n":1,"\r":1,"\x85":1},n={style:1,script:1,textarea:1,input:1},r={"char":{},color:{},mark:{}},B=/['"]([^'"]+)['"]/,C=/(dot|circle|double-circle|triangle|sesame)/,D=/(under|over|left|right)/,E=function(a,b){this.parse(a,b)};E.prototype.set=function(a,b){return"undefined"!=typeof this[a]?!1:(this[a]=b,!0)},E.prototype.parse=function(b,c){var d;if(c){if(!(d=c.match(D)))return this.error=!0,void 0;this.position=d[1]}if(!b)return this.error=!0,void 0;b=b.split(" ");for(var e,f,g=0,h=b.length;h>g;g++){if(e=b[g],d=e.match(B)){var i=d[1];if(i.length>1&&(i=i.charAt(0)),f=this.set("mark",i),this.isStringMark=!0,f)return}else{if(-1!==e.indexOf("none"))return this.isNone=!0,void 0;f=-1!==e.indexOf("filled")?this.set("filled",!0):-1!==e.indexOf("open")?this.set("filled",!1):(d=e.match(C))?this.set("mark",d[1]):this.set("color",a.trim(e))}if(!f)return this.error=!0,void 0}"undefined"==typeof this.mark&&"undefined"==typeof this.filled&&(this.error=!0)},E.prototype.autoComplete=function(){if(!this.isNone){var a=navigator.language||navigator.browserLanguage;a=a.slice(0,2);var b="ja"===a,c="horizontal";null==this.position&&(this.position="vertical"===c?"right":b?"over":"under");var d="undefined"!=typeof this.filled,e="undefined"!=typeof this.mark;d&&e||e&&this.isStringMark||(e?this.filled=!0:d&&(this.mark="vertical"===c?"sesame":"circle"))}},a.fn.emphasis=function(b,e){q();var f=new E(b,e);if(!f.error)return f.autoComplete(),this.each(function(b,e){var g=a(e),h=w();if(h)if(f.isNone)g.css(h[0],"none");else{if(g.data(d))return;g.data(d,!0);var i={};i[h[0]]=f.isStringMark?'"'+f.mark+'"':""+(f.filled?"filled":"open")+" "+f.mark+" "+(f.color||""),i[h[1]]=f.position,g.css(i)}else if(f.isNone)g.html(g.data(c)),g.removeData(c);else{if(g.data(d))return;g.data(d,!0),"undefined"==typeof g.data(c)&&g.data(c,g.html()),f.character=l[f.mark]?l[f.mark][f.filled?0:1]:f.mark.charAt(0),x(g,f)}}),this}}(jQuery);
