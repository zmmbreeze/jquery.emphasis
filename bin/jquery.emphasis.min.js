/*!
 jquery.emphasis.js
 0.1.1
 11-08-2013
*/
!function(a){function b(a,b,c){this.markInfo=a,this.$el=b,this.styleNames=c,this.setEmphasis()}var c,d="9a91ab9b8e64d2cf7fce0616b66efbaf",e="inline-block"+d,f="inline"+d,g="scale"+d,h="over"+d,i="right"+d,j="left"+d,k="under"+d,l={over:h,under:k,right:i,left:j},m={over:":top left;",under:":bottom left;",right:":top right;",left:":top left;"},n={right:1,left:1},o=0,p={dot:["•","◦"],circle:["●","○"],"double-circle":["◉","◎"],triangle:["▲","△"],sesame:["﹅","﹆"]},q={" ":1," ":1,"፡":1,"တ0":1,"တ1":1,"္F":1,"႑F":1,"་":1,"༌":1,"​":1,"　":1," ":1," ":1,"\0":1,"	":1,"\n":1,"\r":1,"":1},r={style:1,script:1,textarea:1,input:1},s={"char":{},color:{},mark:{}},t={addCSSRule:function(b,d){if(!c){var e=document.createElement("style");e.type="text/css",a("head").eq(0).prepend(e),c=document.styleSheets[0]}c.insertRule?c.insertRule(b+"{"+d+"}",c.cssRules.length):c.addRule(b,d,-1)},addBeforeCSSRule:function(a,b,c){var e=s[a];if(e[b])return e[b];var f=a+o++ +d;return this.addCSSRule("."+f+":before",c),e[b]=f,f},testStyle:function(a,b){for(var c=["webkit","moz","o","ms"],d=0,e=c.length;e>d;d++)if(""===a.style[c[d]+b])return c[d]+b;var f=b.charAt(0).toLowerCase()+b.slice(1);return"undefined"!=typeof a.style[f]?f:!1},jsNameToCssName:function(a){return a.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()}).replace(/^(webkit|moz|o|ms)\-/,"-$1-")},supportScale:function y(){if("undefined"!=typeof y.result)return y.result;var a,b=document.createElement("div"),c=this.testStyle(b,"Transform"),d=this.testStyle(b,"TransformOrigin");return c&&d?(c=this.jsNameToCssName(c),d=this.jsNameToCssName(d),a=[c,d]):a=null,y.result=a,a},supportEmphasis:function z(){return!1},supportWritingMode:function A(){if("undefined"!=typeof A.result)return A.result;var a,b=document.createElement("div"),c=this.testStyle(b,"WritingMode");return c?(c=this.jsNameToCssName(c),a=c):a=null,A.result=a,a},initCSSRule:function B(){if(!B.inited){B.inited=!0,this.addCSSRule("."+e,"position:relative;display:inline-block;_zoom:1;float:none;border:none;margin:0;padding:0 0 0.5em 0;vertical-align: baseline;color:inherit;font-size:inherit;font-family:inherit;letter-spacing: normal;text-decoration:inherit;line-height:inherit;"),this.addCSSRule("."+f,"position:relative;float:none;border:none;margin:0;padding:0;vertical-align: baseline;color:inherit;font-size:inherit;font-family:inherit;letter-spacing: normal;text-decoration:inherit;line-height:inherit;");var a="position:absolute;bottom: 0;left: 0;height: 1em;line-height: 1em;text-align: center;width: 100%;float:none;border:none;margin:0;padding:0;vertical-align: baseline;color:inherit;font-size: inherit;font-family:inherit;text-decoration: none;";this.addCSSRule("."+f+":before",a+"bottom: -1em;"),this.addCSSRule("."+e+":before",a),this.addCSSRule("."+f+"."+g+":before","bottom: -0.5em;width: 200%;"),this.addCSSRule("."+e+"."+g+":before","width: 200%;"),this.addCSSRule("."+e+"."+h,"padding:0.5em 0 0 0;"),this.addCSSRule("."+f+"."+h+":before","top: -0.5em;bottom: auto;"),this.addCSSRule("."+e+"."+h+":before","top: 0;bottom: auto;"),this.addCSSRule("."+e+"."+i,"padding:0 0.5em 0 0;"),this.addCSSRule("."+i+":before","vertical-align:middle;height: 100%;line-height: 100%;width: 1em;top: 0;background: red;bottom: auto;"),this.addCSSRule("."+f+"."+i+":before","right: -0.5em;"),this.addCSSRule("."+e+"."+i+":before","right: 0;"),this.addCSSRule("."+i+"."+g+":before","height: 200%;line-height: 200%;width: 1em;")}},getLineHeight:function(a,b){var c=a.css("line-height");return"normal"===c?this.getNormalLineHeight(b):c.match(/px/)?parseInt(c,10):b*c},getNormalLineHeight:function C(b){if("undefined"!=typeof C.result)return C.result;var c=a('<div style="padding:0;display:block;border:0;position:absolute;line-height:normal;overflow:hidden;width:100px;">Some words.</div>');c.css("font-size",b+"px"),c.appendTo("body");var d=c.height();return c.remove(),C.result=d,d}},u=/['"]([^'"]+)['"]/,v=/(dot|circle|double-circle|triangle|sesame)/,w=/(under|over|left|right)/,x=function(a,b){this.parse(a,b)};x.prototype.set=function(a,b){return"undefined"!=typeof this[a]?!1:(this[a]=b,!0)},x.prototype.parse=function(b,c){var d;if(c){if(!(d=c.match(w)))return this.error=!0,void 0;this.position=d[1]}if(!b)return this.error=!0,void 0;b=b.split(" ");for(var e,f,g=0,h=b.length;h>g;g++){if(e=b[g],d=e.match(u)){var i=d[1];if(i.length>1&&(i=i.charAt(0)),f=this.set("mark",i),this.isStringMark=!0,f)return}else{if(-1!==e.indexOf("none"))return this.isNone=!0,void 0;f=-1!==e.indexOf("filled")?this.set("filled",!0):-1!==e.indexOf("open")?this.set("filled",!1):(d=e.match(v))?this.set("mark",d[1]):this.set("color",a.trim(e))}if(!f)return this.error=!0,void 0}"undefined"==typeof this.mark&&"undefined"==typeof this.filled&&(this.error=!0)},x.prototype.autoComplete=function(){if(!this.isNone){var a=navigator.language||navigator.browserLanguage;a=a.slice(0,2);var b="ja"===a;null==this.position&&(this.position=b?"over":"under");var c="undefined"!=typeof this.filled,d="undefined"!=typeof this.mark;c&&d||d&&this.isStringMark||(d?this.filled=!0:c&&(this.mark="circle"))}},b.prototype.removeEmphasis=function(){this.styleNames?this.$el.css(this.styleNames[0],"none"):this.removeEmphasizedTag(this.$el)},b.prototype.setEmphasis=function(){this.markInfo.isNone?this.removeEmphasis():(this.markInfo.autoComplete(),this.styleNames?this.setEmphasisByCSS():this.setEmphasisByFallback())},b.prototype.setEmphasisByCSS=function(){var a={};a[this.styleNames[0]]=this.markInfo.isStringMark?'"'+this.markInfo.mark+'"':""+(this.markInfo.filled?"filled":"open")+" "+this.markInfo.mark+" "+(this.markInfo.color||""),a[this.styleNames[1]]=this.markInfo.position,this.$el.css(a)},b.prototype.setEmphasisByFallback=function(){t.initCSSRule(),this.markInfo.character=p[this.markInfo.mark]?p[this.markInfo.mark][this.markInfo.filled?0:1]:this.markInfo.mark.charAt(0),this.fakeEmphasis(this.$el,this.markInfo)},b.prototype.removeEmphasizedTag=function(b,c){if(this.isEmphasizedTag(b[0]))return b.replaceWith(b.text()),void 0;for(var d,e=b.children(),f=0,g=e.length;g>f;f++)d=a(e[f]),this.isEmphasizedTag(d[0])?d.replaceWith(d.text()):c||this.removeEmphasizedTag(d)},b.prototype.hasEmphasizedTag=function(a){for(var b,c=a.children(),d=0,e=c.length;e>d;d++)if(b=c[d],this.isEmphasizedTag(b))return!0;return!1},b.prototype.isEmphasizedTag=function(a){var b=a.className;return-1!==b.indexOf(e)||-1!==b.indexOf(f)},b.prototype.fakeEmphasis=function(b,c,d){d=d||1,1===d&&this.removeEmphasizedTag(b,!0);for(var e,f=b.contents(),g=0,h=f.length;h>g;g++)if(e=f[g],3===e.nodeType)this.textToHtml(a(e),b,c);else if(1===e.nodeType){var i=this.isEmphasizedTag(e),j=e.nodeName.toLowerCase();r[j]||i||this.fakeEmphasis(a(e),c,d+1)}},b.prototype.textToHtml=function(a,b,c){var d=parseInt(b.css("font-size"),10),h=t.getLineHeight(b,d),i=d/2,j=!1;i>(h-d)/2&&(j=!0);var k=n[c.position];k&&console.log(c);var o,p=t.supportScale();o=p?p[0]+":scale(0.5);"+p[1]+m[c.position]:k?"font-size:"+i+"px;":"font-size:"+i+"px;"+"height:"+i+"px;"+"line-height:"+i+"px;";var r=t.addBeforeCSSRule("mark",c.position+i,o),s="";c.color&&(s=t.addBeforeCSSRule("color",c.color,"color:"+c.color+" !important;"));var u=j?e:f,v=t.addBeforeCSSRule("char",c.character,"content:'"+c.character+"';"),w=l[c.position],x=b.css("letter-spacing"),y="";"normal"!==x&&0!==x&&(y=(k?"margin-bottom:":"margin-right:")+x+";");for(var z,A='<span class="'+u+" "+v+" "+r+" "+s+" "+(p?g:"")+" "+w+'" style="'+y+'">',B="</span>",C=a.text(),D=[],E=0,F=C.length;F>E;E++)z=C.charAt(E),q[z]?D.push(z):(D.push(A),D.push(z),D.push(B));a.replaceWith(D.join(""))},a.fn.emphasis=function(c,d){var e=new x(c,d);if(!e.error)return this.each(function(c,d){var f=a(d),g=t.supportEmphasis();new b(e,f,g)}),this}}(jQuery);